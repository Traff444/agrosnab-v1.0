# АгроСнаб — Руководство пользователя

Это руководство поможет вам управлять каталогом товаров и понимать систему мониторинга.

---

## Содержание

1. [Работа с таблицей Google Sheets](#работа-с-таблицей-google-sheets)
2. [Telegram боты](#telegram-боты)
3. [Система бэкапов](#система-бэкапов)
4. [Мониторинг и алерты](#мониторинг-и-алерты)
5. [Восстановление данных](#восстановление-данных)
6. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## Работа с таблицей Google Sheets

### Структура листа "Склад"

| Колонка | Описание | Правила |
|---------|----------|---------|
| **SKU** | Уникальный код товара | Формат: `PRD-XXXXXX` (6 символов hex) |
| **Наименование** | Название товара | Обязательно, не пустое |
| **Цена_руб** | Цена в рублях | Число > 0 |
| **Остаток_расчет** | Количество на складе | Целое число >= 0 |
| **Фото_URL** | Ссылка на фото | URL начинается с https:// |
| **Активен** | Показывать на сайте? | `да` или `нет` |
| **Теги** | Категории | Через запятую |
| **Описание_кратко** | Короткое описание | До 200 символов |
| **Описание_полное** | Подробное описание | Без ограничений |

### Цветовая индикация

Система автоматически подсвечивает проблемы:

| Цвет | Значение |
|------|----------|
| Красный | Пустое обязательное поле (наименование) |
| Жёлтый | Цена = 0 или отрицательный остаток |
| Зелёный | Товар активен |

### Что НЕ нужно делать

- Не изменяйте заголовки (первая строка защищена)
- Не меняйте формат SKU вручную — используйте бота
- Не удаляйте колонки
- Не переименовывайте лист "Склад"

---

## Telegram боты

### Shop Bot (@agrosna1b_bot)

Бот для покупателей:
- Просмотр каталога
- Поиск товаров
- Оформление заказа
- Расчёт доставки СДЭК

### Owner Bot (@tophitboss_bot)

Бот для владельца (только для вас):

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню |
| `/health` | Проверка системы |
| `/cleanup` | Очистка временных файлов |

**Приход товара:**
1. Нажмите "Приход товара"
2. Введите: `Название Цена Количество`
3. Выберите существующий товар или создайте новый
4. Загрузите фото (опционально)
5. Подтвердите

**Примеры ввода:**
```
Махорка СССР 500 10
Кофе Арабика 1200р 25шт
```

---

## Система бэкапов

### Автоматические бэкапы

| Тип | Частота | Хранится |
|-----|---------|----------|
| Листы в таблице | Ежедневно 03:00 | 7 дней |
| CSV в Google Drive | Еженедельно вс 02:00 | 4 файла |

### Где найти бэкапы

**В таблице:**
- Листы с именем `Бэкап_YYYYMMDD` (скрыты)
- Показать: ПКМ на любом листе → "Показать лист"

**В Google Drive:**
- Папка `Backups` рядом с таблицей
- Файлы `Склад_YYYY-MM-DD.csv`

---

## Мониторинг и алерты

### Ежедневная проверка (09:00)

Система автоматически проверяет:
- Доступность таблицы
- Наличие активных товаров
- Валидность данных (SKU, цены, остатки)
- Корректность URL фото

### Telegram алерты

При обнаружении проблем вы получите сообщение в Telegram:

```
АгроСнаб Alert

Health Check Report
Всего товаров: 150
Активных: 120

WARNING: Найдено 3 строки с проблемами:
  Строка 45: Цена <= 0
  Строка 78: Пустое наименование
  Строка 102: Некорректный URL фото
```

### Уровни алертов

| Уровень | Описание | Действие |
|---------|----------|----------|
| CRITICAL | Таблица недоступна, отсутствуют колонки | Срочно проверить |
| WARNING | Проблемы с данными | Исправить при возможности |

---

## Восстановление данных

### Из бэкап-листа в таблице

1. Откройте Google Sheets
2. Показать скрытые листы (ПКМ → "Показать лист")
3. Найдите нужный `Бэкап_YYYYMMDD`
4. Скопируйте данные (Ctrl+A, Ctrl+C)
5. Перейдите на лист "Склад"
6. Вставьте (Ctrl+V)

**Или через Apps Script:**
1. Extensions → Apps Script
2. В редакторе запустите:
   ```javascript
   restoreFromBackup('Бэкап_20260127');
   ```

### Из CSV в Google Drive

1. Откройте папку `Backups`
2. Скачайте нужный CSV
3. В Google Sheets: File → Import → Upload
4. Выберите "Replace current sheet"

---

## Часто задаваемые вопросы

### Товар не появляется на сайте

**Проверьте:**
1. Колонка "Активен" = `да`
2. SKU не пустой
3. Подождите 1-2 минуты (кэширование)

### Ошибка при добавлении товара

**Возможные причины:**
- Нет интернета
- Истёк токен Google (обратитесь к разработчику)
- Таблица заблокирована другим пользователем

### Как изменить цену?

1. Откройте таблицу Google Sheets
2. Найдите товар по SKU
3. Измените значение в колонке "Цена_руб"
4. Изменения применятся автоматически

### Как скрыть товар?

Измените "Активен" на `нет` — товар останется в базе, но не будет показываться покупателям.

### Как удалить товар полностью?

1. Откройте таблицу
2. Выделите всю строку (клик на номер)
3. ПКМ → "Удалить строку"

**Важно:** Удалённый товар нельзя восстановить (только из бэкапа).

---

## Контакты поддержки

При технических проблемах обращайтесь к разработчику:
- Telegram: [контакт разработчика]
- Email: [email разработчика]

---

*Документ обновлён: Январь 2026*
