# CRM Implementation Summary (v1.1 â†’ v1.3)

**Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** 2026-01-27

---

## ĞĞ±Ğ·Ğ¾Ñ€

Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° CRM-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ²Ğ¾Ñ€Ğ¾Ğ½ĞºÑƒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ² Shop Bot Ğ¸ Owner Bot.

---

## Phase 1: Leads + Events + Funnel (v1.1)

### Ğ§Ñ‚Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

**SQLite Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `crm_events`:**
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ user_id Ğ¸ event_type
- Payload Ğ² JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ² `app/cart_store.py`:**
- `log_crm_event()` â€” Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
- `get_user_events()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸
- `get_user_stage()` â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸
- `compute_stage()` â€” Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ğ´Ğ¸Ğ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ²ĞµÑ€Ñ…)
- `get_user_orders_count()` â€” Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ²
- `get_daily_stats()` â€” ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
- `get_first_seen()` / `get_last_seen()` â€” Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸

**Google Sheets Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² `app/sheets.py`:**
- `upsert_lead()` â€” ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ğ´Ğ°
- `get_lead()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸Ğ´Ğ° Ğ¿Ğ¾ user_id
- `search_leads()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€Ñ‹ Shop Bot:**
- `app/handlers/start.py` â€” ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `start`, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¸Ğ´Ğ°
- `app/handlers/catalog.py` â€” ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ `catalog_view`, `product_view`, `search`
- `app/handlers/cart.py` â€” ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ `add_to_cart`, `checkout_started`, `order_created`

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹
- `app/cart_store.py` (CRM Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸)
- `app/sheets.py` (Leads Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹)
- `app/handlers/start.py`
- `app/handlers/catalog.py`
- `app/handlers/cart.py`
- `app/main.py` (Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° sheets_client)

---

## Phase 2: Metrics + Lead Cards (v1.2)

### Ğ§Ñ‚Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

**Owner Bot Sheets Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ² `owner_bot/app/sheets.py`:**
- `get_leads()` â€” ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ»Ğ¸Ğ´Ğ¾Ğ²
- `get_lead_by_user_id()` â€” Ğ»Ğ¸Ğ´ Ğ¿Ğ¾ ID
- `search_leads()` â€” Ğ¿Ğ¾Ğ¸ÑĞº
- `update_lead_notes()` â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
- `update_lead_tags()` â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ¾Ğ²
- `get_funnel_stats()` â€” ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ²Ğ¾Ñ€Ğ¾Ğ½ĞºĞ¸
- `get_orders_summary()` â€” ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ²

**CRM Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ `owner_bot/app/handlers/crm.py`:**
- Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ CRM Ñ 4 Ğ¾Ğ¿Ñ†Ğ¸ÑĞ¼Ğ¸
- Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ñ€Ğ¾Ğ½ĞºĞ¸ Ñ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸ÑĞ¼Ğ¸
- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ»Ğ¸Ğ´Ğ¾Ğ²
- ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹
- ĞŸĞ¾Ğ¸ÑĞº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² (FSM)
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº Ñ Ñ‚Ğ°Ğ¹Ğ¼ÑÑ‚Ğ°Ğ¼Ğ¿Ğ¾Ğ¼
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ°Ğ¼Ğ¸ (toggle ĞºĞ½Ğ¾Ğ¿ĞºĞ¸)
- Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚

**ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹ `owner_bot/app/keyboards.py`:**
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ° "ğŸ“Š CRM" Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹/Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹
- `owner_bot/app/sheets.py` (CRM Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹)
- `owner_bot/app/handlers/crm.py` (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ~400 ÑÑ‚Ñ€Ğ¾Ğº)
- `owner_bot/app/handlers/__init__.py` (Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ğ°)
- `owner_bot/app/handlers/start.py` (welcome text)
- `owner_bot/app/keyboards.py` (CRM ĞºĞ½Ğ¾Ğ¿ĞºĞ°)

---

## Phase 3: Conversation Logging + AI Summaries (v1.3)

### Ğ§Ñ‚Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

**SQLite Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `crm_messages`:**
- Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ñ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ (in/out)
- Ğ¢Ğ¸Ğ¿ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (text, ai_response)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ğ±Ñ€ĞµĞ·ĞºĞ° Ğ´Ğ¾ 2000 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
- Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ğ¾ user_id

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ² `app/cart_store.py`:**
- `log_crm_message()` â€” Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
- `get_user_messages()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸
- `get_user_messages_count()` â€” Ğ¿Ğ¾Ğ´ÑÑ‡Ñ‘Ñ‚
- `has_user_consent()` â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¸Ñ
- `format_messages_for_ai()` â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°

**Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² AI Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ `app/handlers/ai.py`:**
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ (direction='in')
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… AI-Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (direction='out')
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¸Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒÑ

**Owner Bot Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ `owner_bot/app/crm_db.py`:**
- `get_user_messages()` â€” Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ¾Ğ±Ñ‰ĞµĞ¹ Ğ‘Ğ”
- `get_user_messages_count()`
- `format_messages_for_display()` â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ Telegram
- `generate_ai_summary()` â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ´ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· OpenAI

**Owner Bot CRM Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ:**
- ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ" Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
- ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸ Ñ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸ĞµĞ¹
- ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ğŸ§  AI-ÑĞ²Ğ¾Ğ´ĞºĞ°" (ĞµÑĞ»Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½ OpenAI)
- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ‡ĞµÑ€ĞµĞ· GPT-4o-mini

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ `owner_bot/app/config.py`:**
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ `openai_api_key` Ğ¸ `openai_model`

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹/Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹
- `app/cart_store.py` (crm_messages Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸)
- `app/handlers/ai.py` (Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹)
- `owner_bot/app/crm_db.py` (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ)
- `owner_bot/app/handlers/crm.py` (Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸ AI-ÑĞ²Ğ¾Ğ´ĞºĞ°)
- `owner_bot/app/config.py` (OpenAI Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸)

---

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ¢ĞµÑÑ‚Ñ‹ CRM (18 Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
```
tests/test_crm.py::test_log_crm_event
tests/test_crm.py::test_get_user_events_with_filter
tests/test_crm.py::test_get_user_stage
tests/test_crm.py::test_compute_stage_only_increases
tests/test_crm.py::test_get_user_orders_count
tests/test_crm.py::test_get_daily_stats
tests/test_crm.py::test_get_first_last_seen
tests/test_crm.py::test_full_customer_journey
tests/test_crm.py::test_crm_events_isolation
tests/test_crm.py::test_crm_events_table_created
tests/test_crm.py::test_crm_messages_table_created
tests/test_crm.py::test_log_crm_message
tests/test_crm.py::test_get_user_messages_with_direction_filter
tests/test_crm.py::test_get_user_messages_count
tests/test_crm.py::test_has_user_consent
tests/test_crm.py::test_format_messages_for_ai
tests/test_crm.py::test_crm_messages_isolation
tests/test_crm.py::test_crm_message_truncation
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:** 240 Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ¾ (Ğ²ĞµÑÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚)

---

## Ğ’Ğ¾Ñ€Ğ¾Ğ½ĞºĞ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶

```
        ğŸ†• new (1)
           â”‚
           â–¼ catalog_view / product_view / search
        ğŸ‘€ engaged (2)
           â”‚
           â–¼ add_to_cart
        ğŸ›’ cart (3)
           â”‚
           â–¼ checkout_started
        ğŸ“ checkout (4)
           â”‚
           â–¼ order_created (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°ĞºĞ°Ğ·)
        âœ… customer (5)
           â”‚
           â–¼ order_created (2+ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ²)
        ğŸŒŸ repeat (6)
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** ÑÑ‚Ğ°Ğ´Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ÑÑ, Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¶Ğ°ĞµÑ‚ÑÑ.

---

## ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (.env)

```env
# Ğ£Ğ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ Ğ´Ğ»Ñ Shop Bot:
OPENAI_API_KEY=sk-...

# ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Owner Bot Ğ´Ğ»Ñ AI-ÑĞ²Ğ¾Ğ´Ğ¾Ğº
```

### Google Sheets

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ»Ğ¸ÑÑ‚ "Leads" Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ°Ğ¼Ğ¸:
```
user_id | username | first_seen_at | last_seen_at | stage | orders_count | lifetime_value | last_order_id | consent_at | consent_version | phone | tags | notes
```

---

## Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Shop Bot (ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹)
1. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ /start â†’ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ»Ğ¸Ğ´, Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `start`
2. ĞŸÑ€Ğ¾ÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°ĞµÑ‚ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â†’ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `catalog_view`, ÑÑ‚Ğ°Ğ´Ğ¸Ñ `engaged`
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ â†’ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `add_to_cart`, ÑÑ‚Ğ°Ğ´Ğ¸Ñ `cart`
4. ĞÑ„Ğ¾Ñ€Ğ¼Ğ»ÑĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ· â†’ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `order_created`, ÑÑ‚Ğ°Ğ´Ğ¸Ñ `customer`
5. Ğ’ÑĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ AI-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ (Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¸Ğ¸)

### Owner Bot (Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†)
1. ĞĞ°Ğ¶Ğ°Ñ‚ÑŒ "ğŸ“Š CRM" Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼ Ğ¼ĞµĞ½Ñ
2. "ğŸ“ˆ Ğ’Ğ¾Ñ€Ğ¾Ğ½ĞºĞ°" â€” Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ĞºĞ¾Ğ½Ğ²ĞµÑ€ÑĞ¸Ğ¸
3. "ğŸ‘¥ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ»Ğ¸Ğ´Ñ‹" â€” ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
4. ĞĞ°Ğ¶Ğ°Ñ‚ÑŒ Ğ½Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° â†’ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸ÑĞ¼Ğ¸
5. "ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ" â†’ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ°
6. "ğŸ§  AI-ÑĞ²Ğ¾Ğ´ĞºĞ°" â†’ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SQLite (bot.sqlite3)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ crm_events  â”‚  â”‚ crm_messagesâ”‚  â”‚ cart_items, etc.    â”‚  â”‚
â”‚  â”‚ - user_id   â”‚  â”‚ - user_id   â”‚  â”‚                     â”‚  â”‚
â”‚  â”‚ - event_typeâ”‚  â”‚ - direction â”‚  â”‚                     â”‚  â”‚
â”‚  â”‚ - payload   â”‚  â”‚ - text      â”‚  â”‚                     â”‚  â”‚
â”‚  â”‚ - timestamp â”‚  â”‚ - timestamp â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ sync (Ğ¿Ñ€Ğ¸ upsert_lead)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Google Sheets: "Leads"                     â”‚
â”‚  user_id | username | stage | orders_count | tags | notes   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

- [ ] ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ±Ñ€Ğ¾ÑˆĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½
- [ ] Ğ¡ĞµĞ³Ğ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
- [ ] Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ² Ğ² Excel
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ email/SMS Ñ€Ğ°ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸
- [ ] Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° (LTV, retention)
